var SEARCH_VALUE="搜索...";var ID_CONTENT_DIV="divContent";var authTypeCd,id;var selectOpinion,selectDutyOpinion,pageNo;var shareUserNames,shareUserCds;var delayApproveUserCd="",delayApproveUserName="";var agreeUrl=_ctx+"/wap/wap-approve-info!agree.action";var backUrl=_ctx+"/wap/wap-approve-info!back.action";function init(C,D,B,A){window.id=C;window.selectOpinion=D;window.selectDutyOpinion=B;window.pageNo=A}function openDetail(){var A={id:window.id,"page.pageNo":window.pageNo};$.post(_ctx+"/wap/wap-approve-info!input.action",A,function(B){$("#"+ID_CONTENT_DIV).html(B)});mapTree={}}function doAgree(B,F,G){var D=_ctx+"/wap/wap-approve-info!agree.action";if("21"==B||F=="xujk"){var E=$("#signFile").val();if($.trim(E)==""){alert("请上传总裁签字");return}doProcess(D,"同意")}else{if(F=="xiaoqp"){var A=$("#signFileX").val();if($.trim(A)==""){alert("请上传肖总签字");return}doProcess(D,"同意")}else{if(G=="true"){var C=$("#uploadFlg").val();if(C!="true"){alert("请上传附件");return}doProcess(D,"同意")}else{doProcess(D,"同意")}}}}function doBack(){var B=$("#approveRemark").val();if(isEmpty(B)){alert("请填写驳回原因!");return}var A=confirm("直接驳回给发起人？");if(A==true){doProcess(backUrl,"驳回")}}function initSrhData(){var A={"page.pageNo":pageNo,selectDutyOpinion:selectDutyOpinion,selectOpinion:selectOpinion};return A}function process(D,C,E){var A=$("#idRejectTo").val();var H=$("#idAddNode").val();var F=initSrhData();var B=false;F.id=window.id;F.approveRemark=$("#approveRemark").val();if(isNotEmpty(H)){F["addNode"]=H}if(isNotEmpty(A)){F["rejectTo"]=A}if(isEmpty($("#approveRemark").val())){F["approveRemark"]=E}var G=$("#isEdit").val();if(G=="true"&&D!=backUrl){F["isEdit"]=G;$(".param").each(function(J,I){F[$(I).attr("name")]=$(I).val()});$("#billContent [edit='true']").each(function(){if($(this).attr("validate")=="required"&&$(this).val()==""){$(this).focus();$(this).css({"color":"red","border":"2px solid red"});B=true}else{F[$(this).attr("name")]=$(this).val()}});if(B){alert("该表单需要填写数据!!");return null}$.post(D,F,function(I){if(I=="fail"){alert("操作失败,您无权处理该记录!")}else{window.location.href=_ctx+"/wap/wap-approve-info.action";$("#content").html(I)}if(C){C()}})}else{$(".param").each(function(J,I){F[$(I).attr("name")]=$(I).val()});$.post(D,F,function(I){if(I=="fail"){alert("操作失败,您无权处理该记录!")}else{window.location.href=_ctx+"/wap/wap-approve-info.action";$("#content").html(I)}if(C){C()}})}}function loadApprove(){var A=window.id;if(A!=""){var B={id:A};$.post(_ctx+"/wap/wap-approve-info!loadApprove.action",B,function(C){$("#divApprove").html(C)})}}function reloadMsg(B){var D=window.id;if(D!=""){var A=$("#idReplyMsg").val();var C=$("#isShare").val();var E={id:D,"referMsgId":A};if(isNotEmpty(B)){E.content=B}if(isNotEmpty(C)){E.isShare=C}$.post(_ctx+"/wap/wap-approve-info!say.action",E,function(F){$("#msgContent").html(F)});$("#comment").css("border","0px solid red")}}function doRollback(){var A=confirm("确认追回记录？");if(A==true){var B=initSrhData();B.id=window.id;B.recordVersion=$("#recordVersion").val();$.post(_ctx+"/res/res-approve-info!rollback.action",B,function(C){if(C=="fail"){alert("撤回失败，对方已经签批!")}else{window.location.href=_ctx+"/wap/wap-approve-info.action"}})}}function back2Last(){var A=confirm("确认追回记录？");if(A==true){if(tp=="ok"){var B=initSrhData();B.id=window.id;B.recordVersion=$("#recordVersion").val();$.post(_ctx+"/res/res-approve-info!back2Last.action",B,function(C){if(C=="fail"){alert("撤回失败")}else{$("#content").html(C);resetLeftPanel()}})}}}function doMeeting(){doProcess(agreeUrl,"完成",openMeeting)}function doComplete(){doProcess(agreeUrl,"同意")}function doProcess(D,B,A){var C=$("#approveRemark").val();if(C==""){var E=confirm("您的意见为空，将默认填写同意，请问是否继续？");if(E==true){if(B=="驳回"){$("#isEdit").val("false");$("#approveRemark").val("驳回")}else{if(B=="同意"){$("#approveRemark").val("同意")}}process(D,A)}}else{process(D)}}function doProcessMust(D,B,A){var C=$("#approveRemark").val();if(C==""){alert("请输入你的意见！")}else{process(D)}}function viewApproveHis(){var A=window.id;$.post(_ctx+"/wap/wap-approve-info!showApproveHis.action",{id:A},function(B){$("#"+ID_CONTENT_DIV).html(B)})}function viewSteps(A){$.post(_ctx+"/wap/wap-approve-info!viewSteps.action",{resAuthTypeCd:A},function(B){$("#"+ID_CONTENT_DIV).html(B)})}function loadShare(){var B=window.id;if(isNotEmpty(B)){var A=_ctx+"/res/res-approve-info!loadShare.action";$.post(A,{id:B},function(C){if(C!="fail"){$("#resSharedList").html(C)}})}}function doShare(){var A=_ctx+"/wap/wap-approve-info!doShare.action";$.post(A,{id:window.id},function(B){if(B!="fail"){$("#"+ID_CONTENT_DIV).html(B);setSelectedUser()}})}isEmpty=function(A){return(typeof(A)==="undefined"||A===null||(A.length===0))};isNotEmpty=function(A){return(!isEmpty(A))};function viewDelayApproveHistory(){var A=_ctx+"/wap/wap-approve-delay!history.action";$.post(A,{resApproveId:window.id},function(B){$("#"+ID_CONTENT_DIV).html(B)})}function cancelApproveDelay(){var A=window.id;if(!window.confirm("确认取消?")){return}$.post(_ctx+"/res/res-approve-delay!cancelApproveDelay.action",{resApproveId:A},function(B){if("success"==B){$("#resDelayProcessTip").text("已撤销延期申请!").show().fadeIn(2000).fadeOut(5000);$("#resDelayProcess").html("");$("#btnDoApproveDelay").show();$("#btnCancelApproveDelay").hide()}else{if("process"==B){$("#resDelayProcessTip").text("");$("#resDelayProcess").html("");$("#btnDoApproveDelay").show();$("#btnCancelApproveDelay").hide();alert("您的延期申请已处理,载入中...");loadDelay()}else{alert(B)}}})}function doApproveDelay(){var A=_ctx+"/wap/wap-approve-delay!apply.action";$.post(A,{resApproveId:id},function(B){if(B!="fail"){$("#"+ID_CONTENT_DIV).html(B);$("#delayApproveUserName").val(delayApproveUserName);$("#delayApproveUserCd").val(delayApproveUserCd)}})}function loadDelay(){var A=window.id;$.post(_ctx+"/wap/wap-approve-delay!loadChief.action",{resApproveId:A},function(B){$("#resDelayProcess").html(B)})}function onChiefAgree(A){comChiefDelay(A,"1")}function onChiefDegree(A){comChiefDelay(A,"2")}function comChiefDelay(A,B){var C=window.id;$.post(_ctx+"/wap/wap-approve-delay!reason.action",{id:A,delayChiefTypeCd:B},function(D){$("#"+ID_CONTENT_DIV).html(D)})}function submitDelayChiefReason(B,C){var A=$.trim($("#delayReason").val());if(A==""){alert("请输入意见!");$("#delayReason").focus();return}if("1"==C){if(!window.confirm("确认同意?")){return}$.post(_ctx+"/res/res-approve-delay!chiefAgree.action",{resApproveDelayId:B,reason:A},function(D){if("success"==D){$("#resDelayProcessTip").text("您已同意申请延期!").show().fadeIn(2000);$("#resDelayProcess").html("");openDetail()}else{alert(D)}})}else{if("2"==C){if(!window.confirm("确认拒绝?")){return}$.post(_ctx+"/res/res-approve-delay!chiefDegree.action",{resApproveDelayId:B,reason:A},function(D){if("success"==D){$("#resDelayProcessTip").text("您已拒绝申请延期!").show().fadeIn(2000);$("#resDelayProcess").html("");openDetail()}else{alert(D)}})}}}function openChooseUser(){var A=_ctx+"/wap/wap-approve-info!userChoose.action";$.post(A,{id:window.id},function(B){if(B!="fail"){$("#"+ID_CONTENT_DIV).html(B);setSelectedUser()}})}function doProcessError(){process(backUrl,"流程错误，请查看权责手册，并请选择正确的表单发起审批！")}function doProcessError2(){var A=$("#approveRemark").val();if(isEmpty(A)){alert("请填写详细原因！")}else{$("#isEdit").val("false");process(backUrl)}}function toCeo(){if(window.confirm("确认直接给执行总裁？")){$("#idAddNode").val("toCeo");doProcessMust(agreeUrl,"给执行总裁",null)}}function toPresident(){if(window.confirm("确认直接给总裁？")){$("#idAddNode").val("toPresident");doProcessMust(agreeUrl,"给总裁",null)}}function showUploadedFile(D,B,E){if(isEmpty(D)){return}var A=_ctx+"/app/app-attachment!list.action";var C={id:D,domId:B,canEdit:E,single:"1"};$.post(A,C,function(F){$("#show_"+B).html(F)})}function showReject(){var B=window.id;var A=$("#approveRemark").val();$.post(_ctx+"/wap/wap-approve-info!showRejectTo.action",{id:B},function(C){$("#"+ID_CONTENT_DIV).html(C);$("#approveRemark").val(A)})};